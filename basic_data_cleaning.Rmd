---
title: "Basic Data Cleaning and Vizualizations"
author: "Rage Against The Machine Learning"
date: "26/01/2021"
output:
  prettydoc::html_pretty:
    theme: hpstr

    highlight: github
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Basic Data Cleaning and Vizualization

We clean the data and do some basic data vizualization to get a feel for how the covariates affect one another. 

## Importing and inspecting the data

```{r cars}
# Importing data from Eggafoss
eggafoss <- readRDS("~/water-shrinkage/raw_data_eggafoss.rds")
```

We begin by gauging basic information about the data:

```{r}
summary(eggafoss)

str(eggafoss)
```

Notice that <b>snødekningsgrad</b> is given in percent, so its range is between 0 and 100. The <b>dato</b> column shows that the collection of the data started in 1941 and goes all the up to the end of 2019.

## Missing Data Cleaning

We see from above that we are missing a lot of data from the columns <b>nedbør, snødekningsgrad, snøvannekvivalent, temperatur,</b> and <b>MVF</b>. To view the missing data visually, we use the package <b>naniar</b>:

```{r}
library(naniar)
vis_miss(eggafoss)
```

It seems like all the missing data is from the first 6119 rows. This can be verified by the command:

```{r}
any(is.na(eggafoss[6120:28764, ]))
```
For the first 6119 rows, we are missing so much data that the best option is to remove the first 6119 rows. This corresponds to data before 1958.

```{r}
eggafoss_from_1958 <- eggafoss[6120:28764, ]
head(eggafoss_from_1958)
```

Finally, let us rename the columns so that we avoid abbreviations:

```{r}
names(eggafoss_from_1958)[6:8] <- c("vannføring", "vannstand", "modellertvannføring")
names(eggafoss_from_1958)
```


## Basic Vizualizations

### Correlation Plot

Let us begin by looking at the covariance matrix of our numerical data:

```{r}
correlation_matrix <- cor(eggafoss_from_1958[, 2:8])
print(correlation_matrix)
```
To get a visual look at the correlation matrix, we use the packages <b>reshape2</b> and <b>ggplot2</b>:

```{r}
library(reshape2)
library(ggplot2)

ggplot(data = melt(correlation_matrix), aes(x = Var1, y = Var2, fill = value)) +
  geom_tile()

```

Here we can see some predictable relations, like <b>temperature</b> being highly negatively correlated with <b>snødekningsgrad</b>. It seems like <b>vannstand</b> is highly positively correlated with all the four variables <b>temeratur</b>, <b>snøvannekvivalent</b>, <b>snødekningsgrad</b>, and <b>nedbør</b>.

### Scatterplot

To avoid to many points at once, we sample 2000 points from our data so that the underlying structure of the data becomes clearer:

```{r}
eggafoss_sample <- eggafoss_from_1958[sample(nrow(eggafoss_from_1958), 2000), ]
```


We now  some basic scatterplots with <b>ggplot2</b>:

```{r}
library(ggplot2)
ggplot(data = eggafoss_sample, aes(x = temperatur, y = vannstand)) + geom_point() +
  geom_smooth()
```

Here we see that there is a positive trend, that is most clear in the temperature interval between -10 and 5. This can indicate that <b>vannstand</b> is seasonal-dependend, and that a high <b>vannstand</b> occurs in the spring.

Below, we do three more scatterplots illustrating how <b>vannstand</b> depends on the other variables it is highly positively correlated with:

```{r}
library(ggplot2)
ggplot(data = eggafoss_sample, aes(x = vannføring, y = vannstand)) + geom_point() +
  geom_smooth()
```

```{r}
library(ggplot2)
ggplot(data = eggafoss_sample, aes(x = modellertvannføring, y = vannstand)) + geom_point() +
  geom_smooth()
```